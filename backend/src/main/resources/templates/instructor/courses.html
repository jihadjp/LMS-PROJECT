<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>My Courses</title>
</head>
<body>
<div layout:fragment="content">

    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">
                        <i class="fas fa-book-open mr-2"></i>
                        <span th:text="${pageTitle} ?: 'My Courses'">My Courses</span>
                    </h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a th:href="@{/instructor/dashboard}">Dashboard</a></li>
                        <li class="breadcrumb-item active">My Courses</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <section class="content">
        <div class="container-fluid">

            <!-- Success/Error Messages -->
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <i class="fas fa-check-circle mr-2"></i><span th:text="${success}">Success</span>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <i class="fas fa-exclamation-circle mr-2"></i><span th:text="${error}">Error</span>
            </div>
            <div th:if="${warning}" class="alert alert-warning alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <i class="fas fa-exclamation-triangle mr-2"></i><span th:text="${warning}">Warning</span>
            </div>

            <!-- Statistics Cards -->
            <div class="row">
                <div class="col-lg-2 col-6">
                    <div class="small-box bg-info">
                        <div class="inner">
                            <h3 th:text="${totalCourses} ?: '0'">0</h3>
                            <p>Total</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <a th:href="@{/instructor/courses}" class="small-box-footer">
                            View All <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-6">
                    <div class="small-box bg-secondary">
                        <div class="inner">
                            <h3 th:text="${draftCount} ?: '0'">0</h3>
                            <p>Draft</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-edit"></i>
                        </div>
                        <a th:href="@{/instructor/courses/draft}" class="small-box-footer">
                            View Drafts <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-6">
                    <div class="small-box bg-warning">
                        <div class="inner">
                            <h3 th:text="${pendingCount} ?: '0'">0</h3>
                            <p>Pending</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <a th:href="@{/instructor/courses/pending}" class="small-box-footer">
                            View Pending <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-6">
                    <div class="small-box bg-success">
                        <div class="inner">
                            <h3 th:text="${publishedCount} ?: '0'">0</h3>
                            <p>Published</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <a th:href="@{/instructor/courses/published}" class="small-box-footer">
                            View Published <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-6">
                    <div class="small-box bg-danger">
                        <div class="inner">
                            <h3 th:text="${rejectedCount} ?: '0'">0</h3>
                            <p>Rejected</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <a th:href="@{/instructor/courses/rejected}" class="small-box-footer">
                            View Rejected <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-6">
                    <div class="small-box bg-primary">
                        <div class="inner">
                            <h3><i class="fas fa-plus"></i></h3>
                            <p>New Course</p>
                        </div>
                        <div class="icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <a th:href="@{/instructor/courses/create}" class="small-box-footer">
                            Create Course <i class="fas fa-arrow-circle-right"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Courses Grid -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-list mr-2"></i>Course List
                        <span th:if="${filterStatus}" class="badge badge-info ml-2" th:text="${filterStatus}">Status</span>
                    </h3>
                    <div class="card-tools">
                        <a th:href="@{/instructor/courses/create}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus-circle mr-1"></i>Create New Course
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Empty State -->
                    <div th:if="${#lists.isEmpty(courses)}" class="text-center py-5">
                        <i class="fas fa-book-open fa-4x text-muted mb-3"></i>
                        <h4>No Courses Yet</h4>
                        <p class="text-muted">Start creating your first course to share your knowledge with students.</p>
                        <a th:href="@{/instructor/courses/create}" class="btn btn-primary">
                            <i class="fas fa-plus-circle mr-2"></i>Create Your First Course
                        </a>
                    </div>

                    <!-- Courses Grid -->
                    <div class="row" th:if="${!#lists.isEmpty(courses)}">
                        <div class="col-md-4 mb-4" th:each="course : ${courses}">
                            <div class="card h-100 shadow-sm">
                                <img th:src="${course.p_link} ?: '/images/logo.jpg'"
                                     class="card-img-top"
                                     style="height: 180px; object-fit: cover;"
                                     alt="Course thumbnail"
                                     onerror="this.src='/images/logo.jpg'">
                                <div class="card-body">
                                    <h5 class="card-title text-truncate" th:text="${course.course_name}">Course Name</h5>
                                    <p class="card-text small text-truncate" th:text="${course.description}">
                                        Course description here...
                                    </p>

                                    <div class="mb-2">
                                        <span class="badge"
                                              th:classappend="${course.status.name() == 'PUBLISHED' ? 'badge-success' : (course.status.name() == 'PENDING' ? 'badge-warning' : (course.status.name() == 'REJECTED' ? 'badge-danger' : 'badge-secondary'))}"
                                              th:text="${course.status}">Status</span>
                                        <span class="badge badge-info ml-1" th:if="${course.price > 0}" 
                                              th:text="'৳' + ${course.price}">৳0</span>
                                        <span class="badge badge-success ml-1" th:if="${course.price == 0}">Free</span>
                                    </div>

                                    <!-- Rejection Reason Alert -->
                                    <div class="alert alert-danger small py-1 px-2 mb-2" 
                                         th:if="${course.status.name() == 'REJECTED' and course.rejectionReason}">
                                        <strong>Rejection Reason:</strong> 
                                        <span th:text="${course.rejectionReason}">Reason</span>
                                    </div>

                                    <div class="row text-center small">
                                        <div class="col-6">
                                            <span class="text-muted">Students</span>
                                            <div><strong th:text="${course.enrollmentCount} ?: '0'">0</strong></div>
                                        </div>
                                        <div class="col-6">
                                            <span class="text-muted">Category</span>
                                            <div><strong th:text="${course.category} ?: 'N/A'">N/A</strong></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent">
                                    <div class="btn-group btn-group-sm w-100">
                                        <!-- Edit button (only for DRAFT) -->
                                        <a th:if="${course.status.name() == 'DRAFT'}"
                                           th:href="@{/instructor/courses/edit/{id}(id=${course.course_id})}"
                                           class="btn btn-outline-primary">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>

                                        <!-- View button -->
                                        <a th:href="@{/instructor/courses/view/{id}(id=${course.course_id})}"
                                           class="btn btn-outline-info">
                                            <i class="fas fa-eye"></i> View
                                        </a>

                                        <!-- Submit for Approval (only for DRAFT) -->
                                        <form th:if="${course.status.name() == 'DRAFT'}"
                                              th:action="@{/instructor/courses/submit/{id}(id=${course.course_id})}"
                                              method="post" class="d-inline">
                                            <button type="submit" class="btn btn-outline-success btn-sm"
                                                    onclick="return confirm('Submit this course for admin approval?')">
                                                <i class="fas fa-paper-plane"></i> Submit
                                            </button>
                                        </form>

                                        <!-- Resubmit (only for REJECTED) -->
                                        <form th:if="${course.status.name() == 'REJECTED'}"
                                              th:action="@{/instructor/courses/resubmit/{id}(id=${course.course_id})}"
                                              method="post" class="d-inline">
                                            <button type="submit" class="btn btn-outline-warning btn-sm"
                                                    onclick="return confirm('Resubmit this course for approval?')">
                                                <i class="fas fa-redo"></i> Resubmit
                                            </button>
                                        </form>

                                        <!-- Delete button (only for DRAFT) -->
                                        <form th:if="${course.status.name() == 'DRAFT'}"
                                              th:action="@{/instructor/courses/delete/{id}(id=${course.course_id})}"
                                              method="post" class="d-inline">
                                            <button type="submit" class="btn btn-outline-danger btn-sm"
                                                    onclick="return confirm('Are you sure you want to delete this course? This action cannot be undone.')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

</div>
</body>
</html>