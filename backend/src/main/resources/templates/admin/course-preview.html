<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Course Preview | Admin</title>
    <style>
        .course-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .course-thumbnail {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .stat-box {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .detail-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        .detail-card .card-header {
            background: transparent;
            border-bottom: 1px solid #eee;
            font-weight: 600;
        }
        .action-btn {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .status-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .info-list li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .info-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>

<div layout:fragment="content">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0"><i class="fas fa-eye mr-2"></i>Course Preview</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}">Dashboard</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/admin/courses}">Courses</a></li>
                        <li class="breadcrumb-item active">Preview</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <section class="content">
        <div class="container-fluid">
            <!-- Alert Messages -->
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show">
                <i class="fas fa-check-circle mr-2"></i><span th:text="${success}"></span>
                <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
                <i class="fas fa-exclamation-circle mr-2"></i><span th:text="${error}"></span>
                <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
            </div>

            <!-- Course Header -->
            <div class="course-header">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <img th:src="${course.p_link ?: '/images/logo.jpg'}" 
                             class="course-thumbnail" alt="Course Thumbnail"
                             onerror="this.src='/images/logo.jpg'">
                    </div>
                    <div class="col-md-8">
                        <div class="mb-3">
                            <span class="status-badge"
                                  th:classappend="${course.status.name() == 'PUBLISHED' ? 'bg-success' : 
                                                   (course.status.name() == 'PENDING' ? 'bg-warning text-dark' : 
                                                   (course.status.name() == 'REJECTED' ? 'bg-danger' : 'bg-secondary'))}"
                                  th:text="${course.status}">PENDING</span>
                        </div>
                        <h1 class="mb-3" th:text="${course.course_name}">Course Title</h1>
                        <p class="lead mb-4" th:text="${course.description}">Course Description</p>
                        
                        <div class="row">
                            <div class="col-md-3">
                                <div class="stat-box">
                                    <h3 th:text="'$' + ${course.price}">$0</h3>
                                    <small>Price</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-box">
                                    <h3 th:text="${enrolledCount ?: 0}">0</h3>
                                    <small>Enrolled</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-box">
                                    <h3 th:text="${course.category ?: 'N/A'}">Category</h3>
                                    <small>Category</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-box">
                                    <h3 th:text="${#temporals.format(course.createdAt, 'dd MMM')}">Date</h3>
                                    <small>Created</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Course Details -->
                <div class="col-md-8">
                    <div class="card detail-card mb-4">
                        <div class="card-header">
                            <i class="fas fa-info-circle mr-2"></i>Course Details
                        </div>
                        <div class="card-body">
                            <h5>Description</h5>
                            <p th:text="${course.description}">Course description goes here...</p>
                            
                            <hr>
                            
                            <h5>Preview Links</h5>
                            <ul class="list-unstyled">
                                <li th:if="${course.y_link}">
                                    <i class="fab fa-youtube text-danger mr-2"></i>
                                    <a th:href="${course.y_link}" target="_blank">YouTube Preview</a>
                                </li>
                                <li th:if="${course.p_link}">
                                    <i class="fas fa-image text-primary mr-2"></i>
                                    <a th:href="${course.p_link}" target="_blank">Course Thumbnail</a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Rejection Reason (if rejected) -->
                    <div class="card detail-card mb-4 border-danger" th:if="${course.status.name() == 'REJECTED' and course.rejectionReason}">
                        <div class="card-header bg-danger text-white">
                            <i class="fas fa-times-circle mr-2"></i>Rejection Reason
                        </div>
                        <div class="card-body">
                            <p th:text="${course.rejectionReason}">Rejection reason will appear here.</p>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="col-md-4">
                    <!-- Instructor Info -->
                    <div class="card detail-card mb-4">
                        <div class="card-header">
                            <i class="fas fa-user-tie mr-2"></i>Instructor
                        </div>
                        <div class="card-body text-center">
                            <img src="/images/user.jpg" class="rounded-circle mb-3" style="width: 80px; height: 80px;">
                            <h5 th:text="${course.instructor}">Instructor Name</h5>
                            <p class="text-muted">Course Creator</p>
                        </div>
                    </div>

                    <!-- Course Info -->
                    <div class="card detail-card mb-4">
                        <div class="card-header">
                            <i class="fas fa-list mr-2"></i>Course Info
                        </div>
                        <ul class="list-unstyled info-list mb-0 p-3">
                            <li>
                                <strong><i class="fas fa-folder mr-2 text-primary"></i>Category:</strong>
                                <span class="float-right" th:text="${course.category ?: 'Uncategorized'}">Category</span>
                            </li>
                            <li>
                                <strong><i class="fas fa-dollar-sign mr-2 text-success"></i>Price:</strong>
                                <span class="float-right" th:text="'$' + ${course.price}">$0</span>
                            </li>
                            <li>
                                <strong><i class="fas fa-users mr-2 text-info"></i>Enrolled:</strong>
                                <span class="float-right" th:text="${enrolledCount ?: 0}">0</span>
                            </li>
                            <li>
                                <strong><i class="fas fa-calendar mr-2 text-warning"></i>Created:</strong>
                                <span class="float-right" th:text="${#temporals.format(course.createdAt, 'dd MMM yyyy')}">Date</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Actions -->
                    <div class="card detail-card">
                        <div class="card-header">
                            <i class="fas fa-cogs mr-2"></i>Actions
                        </div>
                        <div class="card-body">
                            <div th:if="${course.status.name() == 'PENDING'}">
                                <form th:action="@{/admin/courses/approve/{id}(id=${course.course_id})}" method="post" class="mb-2">
                                    <button type="submit" class="btn btn-success btn-block action-btn">
                                        <i class="fas fa-check mr-2"></i>Approve Course
                                    </button>
                                </form>
                                <button type="button" class="btn btn-danger btn-block action-btn" 
                                        data-toggle="modal" data-target="#rejectModal">
                                    <i class="fas fa-times mr-2"></i>Reject Course
                                </button>
                            </div>
                            
                            <div th:if="${course.status.name() != 'PENDING'}">
                                <a th:href="@{/admin/courses/view/{id}(id=${course.course_id})}" 
                                   class="btn btn-primary btn-block action-btn mb-2">
                                    <i class="fas fa-edit mr-2"></i>Manage Course
                                </a>
                            </div>
                            
                            <a th:href="@{/admin/courses}" class="btn btn-outline-secondary btn-block action-btn">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Courses
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Reject Modal -->
<div class="modal fade" id="rejectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form th:action="@{/admin/courses/reject/{id}(id=${course.course_id})}" method="post">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title"><i class="fas fa-times-circle mr-2"></i>Reject Course</h5>
                    <button type="button" class="close text-white" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="reason">Rejection Reason</label>
                        <textarea class="form-control" id="reason" name="reason" rows="4" 
                                  placeholder="Please provide a reason for rejection..."></textarea>
                        <small class="text-muted">This will be sent to the instructor.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-times mr-2"></i>Reject Course
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
    <script th:inline="none">
        // Any additional scripts
    </script>
</th:block>

</body>
</html>
